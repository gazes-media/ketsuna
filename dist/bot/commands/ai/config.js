"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return Config}});var _discord=require("discord.js"),_main=require("../../../main"),_database=require("../../functions/database");function asyncGeneratorStep(e,r,t,n,a,o,l){try{var i=e[o](l),s=i.value}catch(e){t(e);return}i.done?r(s):Promise.resolve(s).then(n,a)}function Config(e,r){return _Config.apply(this,arguments)}function _Config(){var e;return e=function(e,r){var t,n,a,o,l,i,s,u,c,d,p,f,g,b,m,h,_,y,v,S,w,C,k,x,N,P,O,j,B,G,U,q,I,L,E,R,T,D,J,K,M,W;return function(e,r){var t,n,a,o,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(t)throw TypeError("Generator is already executing.");for(;l;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=r.call(e,l)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}(this,function(z){switch(z.label){case 0:var A,F;if(!r.isCommand()||(A=t=r.options,null!=(F=_discord.CommandInteractionOptionResolver)&&"undefined"!=typeof Symbol&&F[Symbol.hasInstance]?!F[Symbol.hasInstance](A):!(A instanceof F)))return[3,17];return n=t.getString("model"),a=t.getBoolean("nsfw"),o=t.getString("loras"),l=t.getString("loras_2"),i=t.getString("loras_3"),s=t.getString("loras_4"),u=t.getString("loras_5"),c=t.getString("preprompt"),d=t.getString("negative_prompt"),p=t.getBoolean("loras_preprompt"),f=t.getNumber("cfg_scale"),g=t.getString("sampler"),b=t.getNumber("numbers"),m=t.getNumber("step"),h=t.getNumber("clip_skip"),_=t.getNumber("height"),y=t.getNumber("width"),v=t.getString("upscaler"),S=t.getString("shared_key"),w=t.getBoolean("remove_loras")||!1,[4,r.deferReply({ephemeral:!0})];case 1:return C=z.sent(),[4,(0,_database.getUser)(r.user.id,e.client.database)];case 2:k=z.sent(),x="{p}###{ng}",null===k.horde_config&&null===c&&null===d?c="{p}###{ng}":null!==c&&null!==d?c=x.replace("{ng}",d+"{ng}").replace("{p}",c+"{p}"):null===c&&null!==d?c=x=(x=k.horde_config.definedPrompt).replace("{ng}",d+"{ng}"):null!==c&&null===d&&(c=(x=k.horde_config.definedPrompt).replace("{p}",c+"{p}")),P=Object.keys(N={model:n,nsfw:a,sampler:g,preprompt_loras:p,cfg_scale:f,definedPrompt:c,gen_numbers:b,steps:m,clip_skip:h,height:_,width:y,upscaller:v,sharedKey:S}).filter(function(e){return null!==N[e]}),O={},j=!0,B=!1,G=void 0;try{for(U=P[Symbol.iterator]();!(j=(q=U.next()).done);j=!0)O[I=q.value]=N[I]}catch(e){B=!0,G=e}finally{try{j||null==U.return||U.return()}finally{if(B)throw G}}return[4,(0,_database.createOrUpdateUserWithConfig)(r.user.id,O,e.client.database)];case 3:if(L=z.sent(),!((E=[o,l,i,s,u].filter(function(e){return null!==e})).length>0))return[3,13];return[4,(0,_database.removeLoras)(L.id,e.client.database)];case 4:z.sent(),R=!0,T=!1,D=void 0,z.label=5;case 5:z.trys.push([5,10,11,12]),J=E[Symbol.iterator](),z.label=6;case 6:if(R=(K=J.next()).done)return[3,9];return M=K.value,[4,(0,_database.addLoras)(L.id,M,e.client.database)];case 7:z.sent(),z.label=8;case 8:return R=!0,[3,6];case 9:return[3,12];case 10:return W=z.sent(),T=!0,D=W,[3,12];case 11:try{R||null==J.return||J.return()}finally{if(T)throw D}return[7];case 12:return[3,15];case 13:if(!w)return[3,15];return[4,(0,_database.removeLoras)(L.id,e.client.database)];case 14:z.sent(),z.label=15;case 15:return[4,(0,_database.getUser)(r.user.id,e.client.database)];case 16:k=z.sent(),C.edit({embeds:[new _discord.EmbedBuilder().setTitle(_main.bt.__({phrase:"Config updated !",locale:r.locale})).setColor(_discord.Colors.Green).setDescription((0,_discord.codeBlock)("json",JSON.stringify(k.horde_config,null,2)))]}),z.label=17;case 17:return[2]}})},(_Config=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function l(e){asyncGeneratorStep(o,n,a,l,i,"next",e)}function i(e){asyncGeneratorStep(o,n,a,l,i,"throw",e)}l(void 0)})}).apply(this,arguments)}