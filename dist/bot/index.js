"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return Bot}});var obj,_discord=require("discord.js"),_ai_horde=require("@zeldafan0225/ai_horde"),_listcommands=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(require("./list.commands")),_crypto=(obj=require("crypto"))&&obj.__esModule?obj:{default:obj};function _assert_this_initialized(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)})}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _define_property(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _get_prototype_of(e){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _set_prototype_of(e,t){return(_set_prototype_of=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _ts_generator(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var Bot=function(e){"use strict";!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_set_prototype_of(e,t)}(i,e);var t,r,n,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,n=_get_prototype_of(i);if(t){var o=_get_prototype_of(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(e=r)&&("object"==(e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof e)?e:_assert_this_initialized(this)});function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i);var e,t="development"===process.env.NODE_ENV;_define_property(_assert_this_initialized(e=o.call(this,{intents:[_discord.GatewayIntentBits.Guilds,_discord.GatewayIntentBits.GuildMessages],partials:[_discord.Partials.Channel,_discord.Partials.Message,_discord.Partials.GuildMember,_discord.Partials.User,_discord.Partials.Reaction],allowedMentions:{parse:["users","roles"],repliedUser:!0},presence:{status:"online",activities:[{name:t?"in development":process.env.DISCORD_STATUS_NAME||"Ketsuna is the Best Bot",type:_discord.ActivityType.Playing,state:process.env.DISCORD_STATUS_STATE||"Ketsuna is the Best Bot"}]}})),"timeouts",new Map),_define_property(_assert_this_initialized(e),"aiHorde",new _ai_horde.AIHorde({cache_interval:1e4,cache:{generations_check:3e4},client_agent:"Ketsuna;Discordbot;1.0.1;",default_token:"0000000000"})),_define_property(_assert_this_initialized(e),"commands",new Map),_define_property(_assert_this_initialized(e),"database",void 0),_define_property(_assert_this_initialized(e),"security_key",void 0);var r=process.env.SECURITY_KEY||"R5U8X/A?D(G+KbPeShVmYq3t6w9z$C&F";return e.security_key=Buffer.from(r,"utf-8"),e}return r=[{key:"init",value:function(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){var r;return console.log("Bot is starting..."),e.login(process.env.DISCORD_TOKEN),e.on(_discord.Events.ClientReady,function(){if(console.log("Bot is ready!"),e.loadCommands(),"1100859965616427068"===e.application.id){var t;e.on(_discord.Events.EntitlementCreate,(t=_async_to_generator(function(t){var r;return _ts_generator(this,function(n){switch(n.label){case 0:return[4,t.fetchUser()];case 1:return r=n.sent(),e.channels.fetch("1174557566773252146").then(function(e){e.isTextBased()&&e.send({content:"<@".concat(t.userId,"> (").concat(r.tag,") has purchased Ketsuna Premium!")})}),r.send({content:"If you are not yet in the support server, please join it here: https://discord.gg/wqvBzHe8YQ \n\n This way we can give you your Rewards for suscribing to Ketsuna Premium!",embeds:[{title:"Join the Support Server",url:"https://discord.gg/wqvBzHe8YQ",description:"Thank you for purchasing Ketsuna Premium! You need to be Logged in to the bot to use it.\nPlease use </ai login:".concat(e.commands.get("ai").command.id," to login to the bot.")}]}),[2]}})}),function(e){return t.apply(this,arguments)}))}setTimeout(function(){e.application.commands.fetch().then(function(t){t.forEach(function(t){e.commands.has(t.name)||t.delete().then(function(){console.log("[ApplicationCommand] ".concat(t.name," deleted"))}).catch(function(e){console.log("[ApplicationCommand] ".concat(t.name," not deleted")),console.log(e)})})})},5e3)}),e.on(_discord.Events.InteractionCreate,(r=_async_to_generator(function(t){var r,n;return _ts_generator(this,function(o){return t.isCommand()?(r=e.commands.get(t.commandName))&&r.run(t):t.isAutocomplete()&&(n=e.commands.get(t.commandName))&&n.autocomplete&&n.autocomplete(t),[2]})}),function(e){return r.apply(this,arguments)})),[2]})})()}},{key:"loadCommands",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,o=Object.values(_listcommands)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=new n.value(this);this.commands.set(i.name,i),this.timeouts.set(i.name,new Map)}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}},{key:"decryptString",value:function(e){if(!e.includes(":"))return e;if(this.security_key){var t=Buffer.from(e.split(":")[1],"hex"),r=Buffer.from(e.split(":")[0],"hex"),n=_crypto.default.createDecipheriv("aes-256-cbc",this.security_key,t);return Buffer.concat([n.update(r),n.final()]).toString("utf-8")}}},{key:"encryptString",value:function(e){if(this.security_key){var t=_crypto.default.randomBytes(16),r=_crypto.default.createCipheriv("aes-256-cbc",this.security_key,t);return Buffer.concat([r.update(e),r.final()]).toString("hex")+":"+t.toString("hex")}}},{key:"getLorasModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _async_to_generator(function(){var t,r;return _ts_generator(this,function(n){switch(n.label){case 0:return(t=new URL("https://civitai.com/api/v1/models")).searchParams.append("types","LORA"),t.searchParams.append("primaryFileOnly","true"),e.limit&&t.searchParams.append("limit",e.limit.toString()),e.page&&t.searchParams.append("page",e.page.toString()),e.name&&t.searchParams.append("query",encodeURIComponent(e.name)),[4,fetch(t.toString())];case 1:return[4,n.sent().json()];case 2:if((r=n.sent()).error)return[2,null];return[2,r]}})})()}},{key:"getLorasModel",value:function(e){return _async_to_generator(function(){var t,r;return _ts_generator(this,function(n){switch(n.label){case 0:return t=new URL("https://civitai.com/api/v1/models/".concat(e)),[4,fetch(t.toString())];case 1:return[4,n.sent().json()];case 2:if((r=n.sent()).error)return[2,null];return[2,r]}})})()}}],_defineProperties(i.prototype,r),n&&_defineProperties(i,n),i}(_discord.Client);